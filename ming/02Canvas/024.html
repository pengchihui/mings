<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>行走的小人</title>
    <style type="text/css">
        canvas {
            border: 1px solid #ccc;
            display: block;
            margin: 100px auto;
        }
    </style>
</head>
<body>
    <!-- <img src="./images/01.jpg" alt="" style="display: none;" /> -->
    <canvas id="myCanvas" width="600" height="400"></canvas>
    <script type="text/javascript">
        var Person = function(ctx){
            // 画笔工具
            this.ctx = ctx || document.querySelector('canvas').getContext('2d');

            // 图片的src
            this.src = './images/04.png';

            // 画布的大小
            this.canvasWidth = this.ctx.canvas.width;
            this.canvasHeight = this.ctx.canvas.height;

            // 与行走相关的参数
            this.step = 5;
            // 0 向前  1 向左  2是向右 3向后
            // 因为 方向与 图片上行数的索引相对应
            this.direction = 0;
            this.index = 0;

            // 移动 应该是 按照 图片的坐标来 
            // 我们每一次移动之后，让画布

        };

        Person.prototype.init = function(){
            // 1. 加载图片
            this.loadImage(function(image){
                // 2.默认绘制的x0,y0事在画布的中心位置

                // 图片的大小
                this.imageWidth = image.width;
                this.imageHeight = image.height;

                // 人物的大小
                this.personWidth = this.imageWidth / 4;
                this.personHeight = this.imageHeight / 4;

                //绘制图片的起点
                this.x0 = this.canvasWidth / 2 - this.personWidth /2;
                this.y0 =  this.canvasHeight / 2 - this.personHeight /2;

                // 3. 任务的朝向是正面朝外
                // 绘制图片
                this.ctx.drawImage(image,0,0,this.personWidth,this.personHeight,this.x0,this.y0,this.personWidth,this.personHeight);

                // console.log(image);
                // console.log(this);

                // 4. 通过注册keyDown事件，控制人物行走
                document.onkeydown = function(e){
                    switch (e.keyCode) {
                        case 37:
                            // 左
                            this.direction = 1;
                            this.x0 -= this.step;
                            // this.move(image);
                            break;
                        case 38:
                            // 上
                            this.direction = 3;
                            this.y0 -= this.step;
                            // this.move(image);
                            break;
                        case 39:
                            // 右
                            this.direction = 2;
                            this.x0 += this.step;
                            // this.move(image);
                            break;
                        case 40:
                            // 下
                            this.direction = 0;
                            this.y0 += this.step;
                            // this.move(image);
                            break;
                    }
                    this.move(image);
                    // console.log(e.keyCode);
                }.bind(this);
            }.bind(this));
        };

        Person.prototype.loadImage = function(callback){
            var image = new Image();
            image.onload =function(){
                callback && callback(image);
            };
            image.src = this.src;
        };

        Person.prototype.move =function(image){
            //先清除画布
            this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight);

            this.ctx.drawImage(
                image,
                ++this.index*this.personWidth,
                this.direction * this.personHeight,
                this.personWidth,this.personHeight,
                this.x0,this.y0,
                this.personWidth,this.personHeight
            );
            if(this.index >= 3){
                this.index = 0;
            }
        };

        var ps = new Person();
        ps.init();

    </script>
</body>
</html>